@using TALKPOLL.Models
@model List<TALKPOLL.Models.Survey>
@using Newtonsoft.Json

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="~/css/surveylist.css" asp-append-version="true"/>
    <title>Dashboard|Surveys</title>
</head>
<body>
    <nav>
        <ul class="sidebar">
            <li onclick=hideSidebar()><a href="#"><svg class="menu" xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 -960 960 960" width="26"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></a></li>
                <p class="itm-1">TALKPOLL</p>
                <li tabindex="0">
                    <a href="../Home/Index">
                        <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M120-200q-33 0-56.5-23.5T40-280v-400q0-33 23.5-56.5T120-760h400q33 0 56.5 23.5T600-680v400q0 33-23.5 56.5T520-200H120Zm0-80h400v-400H120v400Zm560 80v-560h80v560h-80Zm160 0v-560h80v560h-80Zm-720-80v-400 400Z"/></svg>
                        Home
                    </a>
                </li>
                    <li tabindex="0">
                        <a href="../Dashboard/Index">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M120-200q-33 0-56.5-23.5T40-280v-400q0-33 23.5-56.5T120-760h400q33 0 56.5 23.5T600-680v400q0 33-23.5 56.5T520-200H120Zm0-80h400v-400H120v400Zm560 80v-560h80v560h-80Zm160 0v-560h80v560h-80Zm-720-80v-400 400Z"/></svg>
                            General info
                        </a>
                    </li>
                    <li tabindex="0">
                        <a href="../Dashboard/Surveylist">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M160-120q-33 0-56.5-23.5T80-200v-560q0-33 23.5-56.5T160-840h640q33 0 56.5 23.5T880-760v560q0 33-23.5 56.5T800-120H160Zm0-80h640v-560H160v560Zm40-80h200v-80H200v80Zm382-80 198-198-57-57-141 142-57-57-56 57 113 113Zm-382-80h200v-80H200v80Zm0-160h200v-80H200v80Zm-40 400v-560 560Z"/></svg>
                            Surveys
                        </a>
                    </li>
                    <li tabindex="0">
                        <a href="#">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-80q-139-35-229.5-159.5T160-516v-244l320-120 320 120v244q0 152-90.5 276.5T480-80Zm0-84q97-30 162-118.5T718-480H480v-315l-240 90v207q0 7 2 18h238v316Z"/></svg>
                            Security
                        </a>
                    </li>
                    <li tabindex="0">
                        <a href="../About/Index">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/></svg>
                            About Us
                        </a>
                    </li>
                    <li tabindex="0">
                        <a href="#">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/></svg>
                            Contact Us
                        </a>
                    </li>
                    <li tabindex="0">
                        <a href="../Login/Index">
                            <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/></svg>
                            Logout
                        </a>
                    </li>

                <div class="cont-us">
                    <h6>Have any problem with how to manage your dashboard?</h6>
                    <div>Contact Us</div>
                </div>

        </ul>
        <ul class="header">
            <li class="appname" ><a href="../Home/Index">TALKPOLL</a></li>

            <li class="menu-btn" onclick=showSidebar()>
                <a href="#">
                    <svg class="menu" xmlns="http://www.w3.org/2000/svg" height="26" viewBox="0 -960 960 960" width="26"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
                </a>
            </li>
            
        </ul> 
        <ul class="logging-btns hideOnMobile">
            <li class=" hideOnLogin"><a href="../Login/Index">Log Out</a></li>          
        </ul>
    </nav>

    <div class="dashboard">
        <div class="panel hideOnMobile">
            <p class="item-1">TALKPOLL</p>
            <ul>
                <li tabindex="0">
                    <a href="../Dashboard/Index">
                        <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M120-200q-33 0-56.5-23.5T40-280v-400q0-33 23.5-56.5T120-760h400q33 0 56.5 23.5T600-680v400q0 33-23.5 56.5T520-200H120Zm0-80h400v-400H120v400Zm560 80v-560h80v560h-80Zm160 0v-560h80v560h-80Zm-720-80v-400 400Z"/></svg>
                        General info
                    </a>
                </li>
                <li tabindex="0">
                    <a href="../Dashboard/Surveylist">
                        <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M160-120q-33 0-56.5-23.5T80-200v-560q0-33 23.5-56.5T160-840h640q33 0 56.5 23.5T880-760v560q0 33-23.5 56.5T800-120H160Zm0-80h640v-560H160v560Zm40-80h200v-80H200v80Zm382-80 198-198-57-57-141 142-57-57-56 57 113 113Zm-382-80h200v-80H200v80Zm0-160h200v-80H200v80Zm-40 400v-560 560Z"/></svg>
                        Surveys
                    </a>
                </li>
                <li tabindex="0">
                    <a href="../Dashboard/Security">
                        <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M480-80q-139-35-229.5-159.5T160-516v-244l320-120 320 120v244q0 152-90.5 276.5T480-80Zm0-84q97-30 162-118.5T718-480H480v-315l-240 90v207q0 7 2 18h238v316Z"/></svg>
                        Security
                    </a>
                </li>
                <li tabindex="0">
                    <a href="../Login/Index">
                        <svg class="icons" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z"/></svg>
                        Logout
                    </a>
                </li>
            </ul>
            <div class="contact-us">
                <h6>Have any problem with how to manage your dashboard?</h6>
                <div>Contact Us</div>
            </div>
        </div>
        <div class="details">
            <div class="welcome">
                <div class="wlc">
                    <p>Welcome Back,</p>
                    <h1>@ViewBag.FirstName @ViewBag.LastName</h1>
                </div>
                <a href="#">
                    <svg class="notification" xmlns="http://www.w3.org/2000/svg" height="30px" viewBox="0 -960 960 960" width="30px" fill="#e8eaed"><path d="M160-200v-80h80v-280q0-83 50-147.5T420-792v-28q0-25 17.5-42.5T480-880q25 0 42.5 17.5T540-820v28q80 20 130 84.5T720-560v280h80v80H160Zm320-300Zm0 420q-33 0-56.5-23.5T400-160h160q0 33-23.5 56.5T480-80ZM320-280h320v-280q0-66-47-113t-113-47q-66 0-113 47t-47 113v280Z"/></svg>
                </a>
         </div>
         <div class="info">
            <div class="container">
                <h2>Surveys</h2>
              <div class="svl" id="surveyList">
              </div>
            </div>

         </div>
        </div>

    </div>

    <script>
        function showSidebar() {
    const sidebar = document.querySelector('.sidebar');
    sidebar.style.display = 'flex';

    document.addEventListener('click', closeSidebarOnClickOutside);

    const button = document.querySelector('.menu-btn');
    button.addEventListener('click', stopPropagation);
}

function closeSidebarOnClickOutside(event) {
    const sidebar = document.querySelector('.sidebar');

    if (!sidebar.contains(event.target)) {
        sidebar.style.display = 'none';
        document.removeEventListener('click', closeSidebarOnClickOutside);
    }
}

function stopPropagation(event) {
    event.stopPropagation();
}

        function hideSidebar(){
            const sidebar = document.querySelector('.sidebar')
            sidebar.style.display = 'none'
        }
        function showSubmenu() {
            const submenu = document.querySelector('.sub-menu');
            const smul = document.querySelector('.sm-ul');
            submenu.style.display = 'block';
            smul.style.display = 'block';

            document.addEventListener('click', closeSubmenuOnClickOutside);
        }

        function closeSubmenuOnClickOutside(event) {
            const submenu = document.querySelector('.sub-menu');
            const button = document.querySelector('.profile-icon');

            if (!submenu.contains(event.target) && event.target !== button) {
               submenu.style.display = 'none';
               document.removeEventListener('click', closeSubmenuOnClickOutside);
            }
        }
    


    const surveys = @Html.Raw(JsonConvert.SerializeObject(
        Model.Select(s => new { title = s.title, link = Url.Action("Details", "Survey", new { id = s.surveyId }) }).ToList()));

        function renderSurveys() {
            const surveyListElement = document.getElementById("surveyList");

            surveyListElement.innerHTML = '';

            surveys.forEach(survey => {
                const surveyDiv = document.createElement('div');
                surveyDiv.classList.add('survey');

                const titleSpan = document.createElement('span');
                titleSpan.classList.add('title');
                titleSpan.textContent = survey.title;

                const button = document.createElement('button');
                button.textContent = "Visit";
                button.addEventListener('click', () => {
                    window.location.href = survey.link;
                });

                surveyDiv.appendChild(titleSpan);
                surveyDiv.appendChild(button);
                surveyListElement.appendChild(surveyDiv);
            });
        }

        document.addEventListener('DOMContentLoaded', renderSurveys);
    </script>
</body>
</html>